const{Pool}=require('pg');const{readFileSync}=require('fs');require('dotenv').config({path:'.env.local'});(async()=>{const p=new Pool({connectionString:process.env.DATABASE_URL});console.log('Reading SQL file...');const sql=readFileSync('scripts/init-database.sql','utf-8').replace(/ALTER TABLE .* ENABLE ROW LEVEL SECURITY;/g,'').replace(/CREATE POLICY.*?(?=CREATE|INSERT|$)/gs,'').replace(/auth\\..*?\(\)/g,'current_user');const stmts=sql.split(/;\\s*\\n/).filter(s=>s.trim()&&!s.startsWith('--')&&s.length>10);console.log(`Found check-tables.js{stmts.length} statements`);let ok=0,skip=0;for(const stmt of stmts){try{await p.query(stmt);if(stmt.includes('CREATE TABLE')){const t=stmt.match(/CREATE TABLE.*?(\\w+)/)?.[1];console.log(`✅ Table: check-tables.js{t}`);}ok++;}catch(e){if(e.message.includes('already exists'))skip++;else if(e.message.includes('function')&&e.message.includes('does not exist'))skip++;else console.log(`Skip: check-tables.js{e.message.substring(0,60)}...`)}}console.log(`\\n✅ Done: check-tables.js{ok} OK, check-tables.js{skip} skipped`);const r=await p.query(`SELECT table_name FROM information_schema.tables WHERE table_schema='public' ORDER BY table_name`);console.log('Tables:',r.rows.map(t=>t.table_name).join(', ')||'(none)');await p.end();process.exit(0)})().catch(e=>{console.error('Error:',e.message);process.exit(1)})
